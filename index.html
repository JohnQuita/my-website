<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Deja Brew Inventory Management System</title>
    <meta name="description" content="Official Inventory System for Deja Brew Coffee Shop Philippines. Manage stocks, expiry dates, and equipment monitoring. Created by Quita.">
    <meta name="author" content="Quita">
    
    </head>
<title>Deja Brew Inventory Management</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
/* ===== 1. GLOBAL AESTHETICS ===== */
:root {
    --primary: #2b1d1a;      /* Deep Espresso */
    --primary-light: #4e3631; 
    --secondary: #a17a69;    /* Latte */
    --accent: #d4a373;       /* Gold/Caramel */
    --graph-color: #7e57c2;  /* Violet for Graph */
    --bg: #f4f7f6;           /* Desktop Background */
    --card-bg: #ffffff;
    --text: #333;
    --sidebar-width: 260px;
    --danger: #e53935;
    --success: #43a047;
}

* { box-sizing: border-box; }
body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }

/* UTILITIES */
.btn { border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
.btn:hover { opacity: 0.9; transform: translateY(-1px); }
.btn:active { transform: translateY(0); }
.btn-primary { background: var(--primary); color: var(--accent); }
.btn-accent { background: var(--accent); color: var(--primary); }
.btn-danger { background: var(--danger); color: white; }
.btn-violet { background: var(--graph-color); color: white; }
.btn-small { padding: 5px 10px; font-size: 12px; }

.card { background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.04); margin-bottom: 20px; border: 1px solid rgba(0,0,0,0.05); }

/* INPUTS */
input, select { border: 1px solid #ddd; padding: 12px; border-radius: 6px; outline: none; transition: 0.3s; width: 100%; font-family: inherit; background: white; }
input:focus, select:focus { border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(161, 122, 105, 0.1); }

/* --- LOGIN SCREEN --- */
#login { display: none; min-height: 100vh; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary) 0%, #1a100e 100%); padding: 20px; }
.login-box { background: rgba(255, 255, 255, 0.95); padding: 40px; border-radius: 16px; text-align: center; width: 100%; max-width: 420px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
.login-logo { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--accent); margin-bottom: 15px; background: white; object-fit: cover; }

/* --- TOP BAR --- */
.top-nav { height: 70px; background: white; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; position: fixed; top: 0; width: 100%; z-index: 1000; box-shadow: 0 2px 15px rgba(0,0,0,0.04); border-bottom: 1px solid #eee; }
.nav-left { display: flex; align-items: center; font-weight: 700; color: var(--primary); font-size: 18px; letter-spacing: 0.5px; min-width: 250px; }
.nav-center { position: absolute; left: 50%; transform: translateX(-50%); font-weight: 600; color: #888; text-transform: uppercase; font-size: 14px; letter-spacing: 2px; display: none; }
.timer-badge { background: var(--primary); color: var(--accent); padding: 6px 15px; border-radius: 30px; font-size: 14px; font-weight: bold; display: flex; align-items: center; gap: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); cursor: help; }

/* --- SIDEBAR --- */
.sidebar { width: var(--sidebar-width); background: var(--primary); padding: 30px 20px; position: fixed; top: 70px; bottom: 0; left: 0; transform: translateX(-100%); transition: 0.3s; z-index: 999; display: flex; flex-direction: column; box-shadow: 4px 0 15px rgba(0,0,0,0.1); }
.sidebar.active { transform: translateX(0); }
.nav-item { padding: 15px 20px; margin-bottom: 10px; border-radius: 8px; color: rgba(255,255,255,0.6); display: flex; align-items: center; gap: 15px; cursor: pointer; transition: 0.2s; font-weight: 500; }
.nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
.nav-item.active { background: var(--accent); color: var(--primary); font-weight: 700; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

/* --- LAYOUT --- */
.content-area { margin-top: 70px; padding: 30px; transition: 0.3s; min-height: 100vh; }
@media (min-width: 900px) {
    .sidebar { transform: translateX(0); }
    .content-area { margin-left: var(--sidebar-width); width: calc(100% - var(--sidebar-width)); }
    .menu-trigger { display: none; }
    .nav-center { display: block; }
    .stats-grid { grid-template-columns: repeat(3, 1fr); }
    .split-dashboard { grid-template-columns: 1fr 1fr; }
}

/* --- DASHBOARD --- */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100%, 1fr)); gap: 25px; margin-bottom: 25px; }
.stat-box { background: white; padding: 25px; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; border: 1px solid #eee; position: relative; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
.stat-box:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); border-color: var(--accent); }
.stat-box h2 { margin: 10px 0; font-size: 42px; color: var(--primary); font-weight: 700; line-height: 1; }
.stat-box span { font-size: 13px; color: #888; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

/* Bar Graph */
.graph-container { display: flex; align-items: flex-end; justify-content: space-around; height: 200px; padding-top: 20px; border-bottom: 1px solid #eee; width: 100%; }
.bar-group { display: flex; flex-direction: column; align-items: center; width: 100%; }
.bar { width: 40px; background: var(--graph-color); border-radius: 6px 6px 0 0; transition: height 1s ease-out; position: relative; opacity: 0.9; }
.bar:hover { opacity: 1; transform: scaleX(1.1); }

/* Lists & Tables */
.split-dashboard { display: grid; gap: 25px; }
.list-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px dashed #eee; font-size: 15px; align-items: center; }
.rank-badge { background: var(--accent); color: var(--primary); width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; margin-right: 10px; }

table { width: 100%; border-collapse: separate; border-spacing: 0; }
th { background: #f8f8f8; color: #666; padding: 15px; text-align: left; font-size: 12px; font-weight: 700; text-transform: uppercase; border-bottom: 2px solid #ddd; }
td { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; color: #444; }
tr:hover td { background: #fcfcfc; }

/* Modal */
.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; backdrop-filter: blur(4px); justify-content: center; align-items: center; padding: 20px; }
.modal-content { background: white; padding: 30px; border-radius: 16px; width: 100%; max-width: 600px; max-height: 85vh; display: flex; flex-direction: column; box-shadow: 0 25px 50px rgba(0,0,0,0.25); }
.cat-filters { display: flex; gap: 10px; padding-bottom: 15px; margin-bottom: 15px; border-bottom: 1px solid #eee; overflow-x: auto; }
.cat-chip { padding: 8px 16px; background: #f4f4f4; border-radius: 30px; font-size: 13px; cursor: pointer; color: #666; transition: 0.2s; white-space: nowrap; }
.cat-chip.active { background: var(--primary); color: var(--accent); }

/* Toast Notification for Errors */
#toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 3000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 14px; }
#toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
#toast.error { background-color: var(--danger); }
@keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
@keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
</style>
</head>
<body onclick="resetTimer()" onkeypress="resetTimer()" onmousemove="resetTimer()">

<div id="toast">Message</div>

<section id="splash" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:var(--primary); color:white; cursor:pointer;" onclick="showLogin()">
    <img src="logo.png" style="width:140px; border-radius:50%; border:4px solid var(--accent); margin-bottom:20px; animation:float 3s infinite;" alt="DB Logo" onerror="this.src='https://via.placeholder.com/150/2b1d1a/d4a373?text=DB'">
    <h1 style="font-size:36px; margin:0;">DEJA BREW</h1>
    <p style="color:var(--accent); letter-spacing:3px; font-size:12px; font-weight:bold;">INVENTORY SYSTEM</p>
    <style>@keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }</style>
</section>

<section id="login">
    <div class="login-box">
        <img src="logo.png" class="login-logo" onerror="this.src='https://via.placeholder.com/100?text=Logo'">
        <h2 style="color:var(--primary); margin:0; font-size:28px; font-weight:800; line-height:1.2;">DEJA BREW</h2>
        <p style="color:#888; margin: 5px 0 30px 0; font-size:14px; font-weight:600; letter-spacing:1px; text-transform:uppercase;">Inventory Management</p>
        
        <div style="text-align:left;">
            <select id="role-select" style="margin-bottom:15px; background:#f9f9f9;">
                <option value="" disabled selected>Select Role</option>
                <option value="Admin">Admin (Quita)</option>
                <option value="Manager">Manager (Omlang)</option>
                <option value="Chef">Chef (Briones)</option>
                <option value="Staff">Staff</option>
            </select>
            <input id="user-input" placeholder="Username" autocapitalize="off" style="margin-bottom:15px; background:#f9f9f9;">
            <input id="pass-input" type="password" placeholder="Password" style="background:#f9f9f9;">
        </div>
        
        <button class="btn btn-primary" style="width:100%; margin-top:25px; padding:15px; font-size:14px;" onclick="authenticate()">SECURE LOGIN</button>
    </div>
</section>

<div id="main-app" style="display:none;">
    
    <div class="top-nav">
        <div class="nav-left">
            <i class="material-icons menu-trigger" onclick="toggleSidebar()" style="margin-right:15px; cursor:pointer; color:var(--primary);">menu</i>
            <span id="page-title">DEJA BREW - DASHBOARD</span>
        </div>
        <div class="nav-center">DEJA BREW INVENTORY SYSTEM</div>
        <div class="timer-badge" title="Auto-logout timer">
            <i class="material-icons" style="font-size:16px;">timer</i>
            <span id="timer">5:00</span>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div style="text-align:center; padding-bottom:20px; border-bottom:1px solid rgba(255,255,255,0.1); margin-bottom:20px;">
            <img id="prof-pic" src="" style="width:80px; height:80px; border-radius:50%; border:3px solid var(--accent); object-fit:cover; background:white;" onerror="this.src='https://via.placeholder.com/80'">
            <h3 id="prof-name" style="margin:10px 0 5px 0; color:white;">User</h3>
            <span id="prof-role" style="background:var(--accent); color:var(--primary); padding:4px 12px; border-radius:15px; font-size:11px; font-weight:bold; text-transform:uppercase;">Role</span>
        </div>

        <div class="nav-item active" onclick="nav('dashboard')"><i class="material-icons">dashboard</i> Dashboard</div>
        <div class="nav-item" onclick="nav('inventory')"><i class="material-icons">inventory_2</i> Inventory</div>
        <div class="nav-item" onclick="nav('reports')"><i class="material-icons">analytics</i> Reports</div>
        <div class="nav-item" onclick="nav('history')"><i class="material-icons">history</i> Logs</div>

        <button class="btn" style="background:rgba(255,255,255,0.1); color:white; margin-top:auto; justify-content: flex-start; padding-left:20px;" onclick="logout()">
            <i class="material-icons">logout</i> Sign Out
        </button>
    </div>

    <div class="content-area">
        
        <div id="view-dashboard" class="view-section">
            <div class="stats-grid">
                <div class="stat-box" style="border-bottom: 4px solid var(--secondary);" onclick="openDrillDown('TOTAL')">
                    <h2 id="d-total">0</h2><span>Total Items</span>
                </div>
                <div class="stat-box" style="border-bottom: 4px solid #fbc02d;" onclick="openDrillDown('LOW')">
                    <h2 id="d-low">0</h2><span>Low Stock</span>
                </div>
                <div class="stat-box" style="border-bottom: 4px solid #e53935;" onclick="openDrillDown('EXPIRE')">
                    <h2 id="d-expire">0</h2><span style="color:#e53935;">Expiring Soon</span>
                </div>
            </div>

            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0; color:var(--primary);">Stock Volume by Category</h3>
                </div>
                <div class="graph-container" id="bar-graph"></div>
            </div>

            <div class="split-dashboard">
                <div class="card">
                    <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:15px; color:var(--primary);">
                        <i class="material-icons" style="vertical-align:middle; color:var(--accent);">trending_up</i> Top 5 Most Used
                    </h3>
                    <div id="trend-list"></div>
                </div>
                <div class="card" style="background:#fffcf5; border:1px solid #ffe0b2;">
                    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #fae0b5; padding-bottom:15px;">
                        <h3 style="margin:0; color:#e65100;"><i class="material-icons" style="vertical-align:middle;">restaurant_menu</i> Menu Highlights</h3>
                        <i id="edit-menu-btn" class="material-icons" style="cursor:pointer; color:#ef6c00; display:none;" onclick="editBestSellers()">edit</i>
                    </div>
                    <div id="menu-best-list" style="font-size:15px; line-height:1.8; color:#bf360c; margin-top:15px; white-space: pre-line;"></div>
                </div>
            </div>
        </div>

        <div id="view-inventory" class="view-section" style="display:none;">
            <div class="card">
                <div style="display:grid; grid-template-columns: 2fr 1fr; gap:20px; align-items:end;">
                    <div><h3 style="margin-top:0;">Stock Management</h3><p style="font-size:13px; color:#666;">Add/Update stock levels.</p></div>
                    <div>
                         <label style="font-size:11px; font-weight:bold; color:var(--primary);">ACTION</label>
                         <select id="stock-action-type" style="background: #f0f4f8; font-weight:bold;" onchange="toggleDateInput()">
                             <option value="IN">➕ STOCK IN (Restock)</option>
                             <option value="OUT">➖ STOCK OUT (Usage)</option>
                         </select>
                    </div>
                </div>
                <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">

                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:15px;">
                    <div>
                        <label style="font-size:11px; color:#888;">Category</label>
                        <div style="display:flex; gap:2px;">
                            <select id="inv-cat"></select>
                            <button onclick="manageCustom('category', 'add')" class="btn btn-primary btn-small" title="Add">+</button>
                            <button onclick="manageCustom('category', 'remove')" class="btn btn-danger btn-small" title="Delete">-</button>
                        </div>
                    </div>
                    <div>
                        <label style="font-size:11px; color:#888;">Item Name</label>
                        <input id="inv-name" placeholder="E.g. Coffee Beans">
                    </div>
                    <div>
                        <label style="font-size:11px; color:#888;">Quantity & Unit</label>
                        <div style="display:flex; gap:2px;">
                            <input id="inv-qty" type="number" placeholder="0">
                            <select id="inv-unit" style="width:90px;"></select>
                            <button onclick="manageCustom('unit', 'add')" class="btn btn-primary btn-small" title="Add">+</button>
                            <button onclick="manageCustom('unit', 'remove')" class="btn btn-danger btn-small" title="Delete">-</button>
                        </div>
                    </div>
                </div>
                
                <div id="expiry-wrapper" style="margin-top:15px;">
                     <label style="font-size:11px; font-weight:bold; color:#d32f2f;">Expiration Date</label>
                     <input id="inv-expiry" type="date">
                </div>

                <button class="btn" style="width:100%; margin-top:20px; background:var(--primary); color:white; padding:15px;" onclick="processStock()">CONFIRM TRANSACTION</button>
            </div>

            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="margin:0;">Current Inventory</h3>
                    <input id="search-bar" onkeyup="renderInventory()" placeholder="Search..." style="padding:10px; width: 200px;">
                </div>
                <div style="overflow-x:auto;">
                    <table>
                        <thead><tr><th>Item Name</th><th>Category</th><th>Quantity</th><th>Status / Expiry</th><th>Manage</th></tr></thead>
                        <tbody id="inventory-table-body"></tbody>
                    </table>
                </div>
                <div class="pagination" style="display:flex; justify-content:center; gap:15px; margin-top:25px; align-items:center;">
                    <button class="btn btn-primary" onclick="changePage(-1)"><</button>
                    <span id="page-num" style="font-size:13px; font-weight:bold;">Page 1</span>
                    <button class="btn btn-primary" onclick="changePage(1)">></button>
                </div>
            </div>
        </div>

        <div id="view-reports" class="view-section" style="display:none;">
            <div class="card">
                <h3 style="margin-top:0;">Download Reports</h3>
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-top:25px;">
                    <button class="btn" style="background:#e3f2fd; color:#1565c0; flex-direction:column; padding:30px; border:1px solid #bbdefb;" onclick="exportReport('LOW')">
                        <i class="material-icons" style="font-size:32px; margin-bottom:10px;">warning</i> Low Stock
                    </button>
  